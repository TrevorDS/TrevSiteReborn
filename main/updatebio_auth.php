<?php

require("../SITE_CONFIG.php");
require("../main/setup.php");
/*
 * Written by Trevor
 * 4/21/21
 * 
 */
////////////////////////////////////////////////////////////////////////////////
// CONSTANTS
////////////////////////////////////////////////////////////////////////////////
$TABLE = "user_data";
$UserID = $_POST["UserID"];
$CALLBACK_PAGE = $PAGES . "profile?user=$UserID";

if (!isset($UserID) || $UserID === null) {
    $CALLBACK_PAGE = $DEFAULT_CALLBACK_REDIRECT;
}

////////////////////////////////////////////////////////////////////////////////
// Variables
////////////////////////////////////////////////////////////////////////////////
$NEW_BIO = FilterInput($_POST["updateBio"]);

////////////////////////////////////////////////////////////////////////////////
// Functions
////////////////////////////////////////////////////////////////////////////////

function ValidateInput($bio) {
    
    global $CALLBACK_PAGE;
    
    if ($bio === "" || strlen($bio) === 0) {
        header("Location: $CALLBACK_PAGE");
        exit;
    }
}

////////////////////////////////////////////////////////////////////////////////
// INIT
////////////////////////////////////////////////////////////////////////////////
// POST VERIFICATION
if (!$_POST) {
    header("Location: $CALLBACK_PAGE");
    exit;
}

ValidateInput($NEW_BIO);

////////////////////////////////////////////////////////////////////////////////
// RUN-TIME
////////////////////////////////////////////////////////////////////////////////

// Create connection
$conn = new mysqli($DB_SERVER_NAME, $DB_USERNAME, $DB_PASSWORD, $DB_NAME);

// Check connection
if ($conn->connect_error) {
    header("Location: $CALLBACK_PAGE");
    exit;
}

$sql = "UPDATE $TABLE SET bio='" . $NEW_BIO . "' WHERE user_id='$UserID'";

// Run the SQL Command
$conn->query($sql);
        
$conn->close();


header("Location: $CALLBACK_PAGE");
exit;